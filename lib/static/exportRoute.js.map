{"version":3,"sources":["../../src/static/exportRoute.js"],"names":["cachedBasePath","cachedHrefReplace","cachedSrcReplace","cachedLinkHrefReplace","config","Comp","DocumentTemplate","route","siteData","clientStats","incremental","sharedHashesByProp","template","data","sharedData","routePath","path","remove","Error","removeLocation","nodePath","join","paths","DIST","fs","basePath","hrefReplace","RegExp","srcReplace","linkHrefReplace","routeInfo","embeddedRouteInfo","renderMeta","chunkNames","head","clientScripts","clientStyleSheets","clientCss","disableRuntime","redirect","FinalComp","props","chunkName","startsWith","ROOT","push","renderToStringAndExtract","comp","appHtml","outputPath","scripts","stylesheets","css","helmet","Helmet","renderStatic","htmlProps","htmlAttributes","toComponent","bodyProps","bodyAttributes","base","link","meta","noscript","script","style","title","beforeRenderToElementHook","plugins","renderToElement","RenderedComp","beforeRenderToHtml","renderToHtml","beforeHtmlToDocument","message","component","renderToStaticMarkup","__html","DocumentHtml","html","beforeDocumentToFile","publicPath","process","env","REACT_STATIC_PUBLIC_PATH","REACT_STATIC_DISABLE_ROUTE_PREFIXING","replace","REACT_STATIC_BASE_PATH","htmlFilename","routeInfoFilename","Promise","all","outputFile","outputJson","resolve","res","exportRoute"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { renderToString, renderToStaticMarkup } from 'react-dom/server'\nimport Helmet from 'react-helmet'\nimport { ReportChunks } from 'react-universal-component'\nimport flushChunks from 'webpack-flush-chunks'\nimport nodePath from 'path'\nimport fs from 'fs-extra'\n\nimport Redirect from './components/Redirect'\nimport { makePathAbsolute, makeHookReducer } from '../utils'\nimport { absoluteToRelativeChunkName } from '../utils/chunkBuilder'\n\nimport { makeHtmlWithMeta } from './components/HtmlWithMeta'\nimport { makeHeadWithMeta } from './components/HeadWithMeta'\nimport { makeBodyWithMeta } from './components/BodyWithMeta'\n\n//\n\nlet cachedBasePath\nlet cachedHrefReplace\nlet cachedSrcReplace\nlet cachedLinkHrefReplace\n\nexport default (async function exportRoute({\n  config,\n  Comp,\n  DocumentTemplate,\n  route,\n  siteData,\n  clientStats,\n  incremental,\n}) {\n  const {\n    sharedHashesByProp,\n    template,\n    data,\n    sharedData,\n    path: routePath,\n    remove,\n  } = route\n\n  if (incremental && remove) {\n    if (route.path === '404' || route.path === '/') {\n      throw new Error(\n        `You are attempting to incrementally remove the ${\n          route.path === '404' ? '404' : 'index'\n        } route from your export. This is currently not supported (or recommended) by React Static.`\n      )\n    }\n    const removeLocation = nodePath.join(config.paths.DIST, route.path)\n    return fs.remove(removeLocation)\n  }\n\n  const basePath = cachedBasePath || (cachedBasePath = config.basePath)\n\n  const hrefReplace =\n    cachedHrefReplace ||\n    (cachedHrefReplace = new RegExp(\n      `(href=[\"'])\\\\/(${basePath ? `${basePath}\\\\/` : ''})?([^\\\\/])`,\n      'gm'\n    ))\n\n  const srcReplace =\n    cachedSrcReplace ||\n    (cachedSrcReplace = new RegExp(\n      `(src=[\"'])\\\\/(${basePath ? `${basePath}\\\\/` : ''})?([^\\\\/])`,\n      'gm'\n    ))\n\n  // mbrowne added\n  const linkHrefReplace =\n    cachedLinkHrefReplace ||\n    (cachedLinkHrefReplace = new RegExp('(<link\\\\s[^>]*href=[\"\\'])\\\\/', 'gm'))\n\n  // This routeInfo will be saved to disk. It should only include the\n  // data and hashes to construct all of the props later.\n  const routeInfo = {\n    template,\n    sharedHashesByProp,\n    data,\n    path: routePath,\n  }\n\n  // This embeddedRouteInfo will be inlined into the HTML for this route.\n  // It should include all of the data, including shared data\n  const embeddedRouteInfo = {\n    ...routeInfo,\n    sharedData,\n    siteData,\n  }\n\n  // Make a place to collect chunks, meta info and head tags\n  const renderMeta = {}\n  const chunkNames = []\n  let head = {}\n  let clientScripts = []\n  let clientStyleSheets = []\n  let clientCss = {}\n\n  let FinalComp\n\n  // Get the react component from the Comp and\n  // pass it the export context. This uses\n  // reactContext under the hood to pass down\n  // the exportContext, since react's new context\n  // api doesn't survive across bundling.\n  Comp = config.disableRuntime ? Comp : Comp(embeddedRouteInfo)\n\n  if (route.redirect) {\n    FinalComp = () => <Redirect fromPath={route.path} to={route.redirect} />\n  } else {\n    FinalComp = props => (\n      <ReportChunks\n        report={chunkName => {\n          // if we are building to a absolute path we must make the detected chunkName relative and matching to the one we set in generateTemplates\n          if (!config.paths.DIST.startsWith(config.paths.ROOT)) {\n            chunkName = absoluteToRelativeChunkName(\n              config.paths.ROOT,\n              chunkName\n            )\n          }\n\n          chunkNames.push(chunkName)\n        }}\n      >\n        <Comp {...props} />\n      </ReportChunks>\n    )\n  }\n\n  const renderToStringAndExtract = comp => {\n    // Rend the app to string!\n    const appHtml = renderToString(comp)\n    const { scripts, stylesheets, css } = flushChunks(clientStats, {\n      chunkNames,\n      outputPath: config.paths.DIST,\n    })\n\n    clientScripts = scripts\n    clientStyleSheets = stylesheets\n    clientCss = css\n    // Extract head calls using Helmet synchronously right after renderToString\n    // to not introduce any race conditions in the meta data rendering\n    const helmet = Helmet.renderStatic()\n    head = {\n      htmlProps: helmet.htmlAttributes.toComponent(),\n      bodyProps: helmet.bodyAttributes.toComponent(),\n      base: helmet.base.toComponent(),\n      link: helmet.link.toComponent(),\n      meta: helmet.meta.toComponent(),\n      noscript: helmet.noscript.toComponent(),\n      script: helmet.script.toComponent(),\n      style: helmet.style.toComponent(),\n      title: helmet.title.toComponent(),\n    }\n\n    return appHtml\n  }\n\n  let appHtml\n\n  try {\n    const beforeRenderToElementHook = makeHookReducer(\n      config.plugins,\n      'beforeRenderToElement'\n    )\n    FinalComp = await beforeRenderToElementHook(FinalComp, {\n      config,\n      meta: renderMeta,\n    })\n\n    if (config.renderToElement) {\n      throw new Error(\n        `config.renderToElement has been deprecated in favor of the 'beforeRenderToElement' or 'beforeRenderToHtml' hooks instead.`\n      )\n    }\n\n    let RenderedComp = <FinalComp />\n\n    // Run the beforeRenderToHtml hook\n    // Rum the Html hook\n    const beforeRenderToHtml = makeHookReducer(\n      config.plugins,\n      'beforeRenderToHtml'\n    )\n    RenderedComp = await beforeRenderToHtml(RenderedComp, {\n      config,\n      meta: renderMeta,\n    })\n\n    if (config.renderToHtml) {\n      throw new Error(\n        `config.renderToHtml has been deprecated in favor of the 'beforeRenderToHtml' or 'beforeHtmlToDocument' hooks instead.`\n      )\n    }\n\n    appHtml = renderToStringAndExtract(RenderedComp)\n\n    // Rum the beforeHtmlToDocument hook\n    const beforeHtmlToDocument = makeHookReducer(\n      config.plugins,\n      'beforeHtmlToDocument'\n    )\n    appHtml = await beforeHtmlToDocument(appHtml, { config, meta: renderMeta })\n  } catch (error) {\n    error.message = `Failed exporting HTML for URL ${route.path} (${\n      route.component\n    }): ${error.message}`\n    throw error\n  }\n\n  const DocumentHtml = renderToStaticMarkup(\n    <DocumentTemplate\n      Html={makeHtmlWithMeta({ head })}\n      Head={\n        await makeHeadWithMeta({\n          head,\n          route,\n          clientScripts,\n          config,\n          clientStyleSheets,\n          clientCss,\n          meta: renderMeta,\n        })\n      }\n      Body={makeBodyWithMeta({\n        head,\n        route,\n        embeddedRouteInfo,\n        clientScripts,\n        config,\n      })}\n      siteData={siteData}\n      routeInfo={embeddedRouteInfo}\n      renderMeta={renderMeta}\n    >\n      <div id=\"root\" dangerouslySetInnerHTML={{ __html: appHtml }} />\n    </DocumentTemplate>\n  )\n\n  // Render the html for the page inside of the base document.\n  let html = `<!DOCTYPE html>${DocumentHtml}`\n\n  // Rum the beforeDocumentToFile hook\n  const beforeDocumentToFile = makeHookReducer(\n    config.plugins,\n    'beforeDocumentToFile'\n  )\n  html = await beforeDocumentToFile(html, { meta: renderMeta })\n\n  // If the siteRoot is set and we're not in staging, prefix all absolute URLs\n  // with the siteRoot\n  const publicPath = makePathAbsolute(process.env.REACT_STATIC_PUBLIC_PATH)\n  if (process.env.REACT_STATIC_DISABLE_ROUTE_PREFIXING !== 'true') {\n    html = html.replace(hrefReplace, `$1${publicPath}$3`)\n  }\n  // mbrowne added\n  else if (process.env.REACT_STATIC_BASE_PATH) {\n    html = html.replace(linkHrefReplace, `$1${publicPath}`)\n  }\n\n  html = html.replace(srcReplace, `$1${publicPath}$3`)\n\n  // If the route is a 404 page, write it directly to 404.html, instead of\n  // inside a directory.\n  const htmlFilename =\n    route.path === '404'\n      ? nodePath.join(config.paths.DIST, '404.html')\n      : nodePath.join(config.paths.DIST, route.path, 'index.html')\n\n  // Make the routeInfo sit right next to its companion html file\n  const routeInfoFilename = nodePath.join(\n    config.paths.DIST,\n    route.path,\n    'routeInfo.json'\n  )\n\n  const res = await Promise.all([\n    fs.outputFile(htmlFilename, html),\n    !route.redirect\n      ? fs.outputJson(routeInfoFilename, routeInfo)\n      : Promise.resolve(),\n  ])\n  return res\n})\n"],"file":"exportRoute.js"}